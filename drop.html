<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WEIRD WIZ — Drop</title>
<style>
@font-face { font-family: 'OffBit'; src: url('fonts/OffBit-101Bold.otf') format('opentype'); }
@font-face { font-family: 'AuthenticSans'; src: url('fonts/60b11050899817005a227b9e.otf') format('opentype'); }
@font-face { font-family: 'GTPressura'; src: url('fonts/gt-pressura-mono-regular.ttf') format('truetype'); }
@font-face { font-family: 'MyriadPro'; src: url('fonts/MyriadPro-Regular.otf') format('opentype'); }

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #0a0a08; --fg: #e8e8d8; --red: #E8320A;
  --green: #00ff41; --blue: #3355ff; --purple: #cc44ff; --yellow: #f2e04a;
  --f-title: 'AuthenticSans', 'OffBit', monospace;
  --f-ui: 'GTPressura', monospace;
  --f-body: 'MyriadPro', sans-serif;
}

html { overflow-x: hidden; }
body { background: var(--bg); color: var(--fg); font-family: var(--f-body); overflow-x: hidden; cursor: crosshair; }

body::before {
  content: ''; position: fixed; inset: 0;
  background: repeating-linear-gradient(0deg, transparent, transparent 3px, rgba(0,0,0,0.04) 3px, rgba(0,0,0,0.04) 4px);
  pointer-events: none; z-index: 997;
}

/* NAV */
nav {
  position: fixed; top: 0; left: 0; right: 0; z-index: 200;
  display: flex; justify-content: space-between; align-items: flex-start;
  padding: 16px 24px; background: var(--bg);
  border-bottom: 1px solid rgba(232,50,10,0.25);
}
.nav-logo { display: flex; flex-direction: column; gap: 3px; }
.nav-logo-title { font-family: var(--f-title); font-size: 26px; color: var(--red); letter-spacing: 0.06em; line-height: 1; text-decoration: none; }
.nav-logo-sub { font-family: var(--f-ui); font-size: 8.5px; color: rgba(232,50,10,0.55); letter-spacing: 0.04em; line-height: 1.45; }
.nav-links { display: flex; align-items: center; list-style: none; gap: 0; flex-wrap: wrap; justify-content: flex-end; }
.nav-sep { color: var(--red); font-size: 11px; padding: 0 5px; opacity: 0.6; }
.nav-links a { font-family: var(--f-ui); font-size: 11.5px; color: var(--fg); text-decoration: none; letter-spacing: 0.06em; padding: 2px 4px; transition: color 0.15s; }
.nav-links a:hover { color: var(--red); }
.nav-links a.active { color: var(--red); }

/* LAYOUT */
.drop-wrap {
  padding: 96px 24px 100px;
  display: grid;
  grid-template-columns: 1fr 320px;
  gap: 48px;
  max-width: 1200px;
  margin: 0 auto;
  align-items: start;
}

/* COLUNA PRINCIPAL */
.drop-main {}

.back-btn {
  display: inline-block;
  font-family: var(--f-ui);
  font-size: 10px;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  color: var(--fg);
  text-decoration: none;
  border: 1px solid var(--red);
  padding: 10px 28px;
  margin-bottom: 48px;
  transition: background 0.15s, color 0.15s;
}
.back-btn:hover { background: var(--red); }

/* HEADER DO DROP */
.drop-header {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 32px;
  margin-bottom: 48px;
  align-items: start;
}

.drop-cover-large {
  width: 180px;
  flex-shrink: 0;
}

.drop-cover-img {
  width: 180px;
  aspect-ratio: 2/3;
  object-fit: cover;
  display: block;
  filter: contrast(1.1) brightness(0.9) saturate(0.6);
  border: 1px solid rgba(255,255,255,0.08);
}

.drop-cover-placeholder {
  width: 180px;
  aspect-ratio: 2/3;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--f-ui);
  font-size: 9px;
  letter-spacing: 0.15em;
  color: rgba(255,255,255,0.12);
  border: 1px solid rgba(255,255,255,0.08);
}

.drop-cover-placeholder.type-book    { background: #1a1208; }
.drop-cover-placeholder.type-album   { background: #08121a; aspect-ratio: 1; }
.drop-cover-placeholder.type-podcast { background: #120a1a; aspect-ratio: 1; }
.drop-cover-placeholder.type-film    { background: #0a1a0a; aspect-ratio: 16/10; }

.drop-header-info {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding-top: 4px;
}

.drop-type-badge {
  display: inline-block;
  font-family: var(--f-ui);
  font-size: 8px;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  padding: 4px 10px;
  width: fit-content;
}
.drop-type-badge.type-book    { color: var(--yellow); border: 1px solid var(--yellow); }
.drop-type-badge.type-album   { color: var(--green);  border: 1px solid var(--green);  }
.drop-type-badge.type-podcast { color: var(--purple); border: 1px solid var(--purple); }
.drop-type-badge.type-film    { color: var(--blue);   border: 1px solid var(--blue);   }

.drop-detail-title {
  font-family: var(--f-title);
  font-size: clamp(28px, 4vw, 54px);
  letter-spacing: 0.03em;
  line-height: 1.02;
}

.drop-detail-author {
  font-family: var(--f-ui);
  font-size: 10px;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: rgba(232,232,216,0.4);
}

.drop-detail-note {
  font-family: var(--f-body);
  font-size: 17px;
  line-height: 1.65;
  color: rgba(232,232,216,0.6);
  border-left: 2px solid var(--red);
  padding-left: 16px;
  margin-top: 4px;
}

.drop-external-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-family: var(--f-ui);
  font-size: 9px;
  letter-spacing: 0.16em;
  text-transform: uppercase;
  color: var(--fg);
  text-decoration: none;
  border: 1px solid rgba(232,232,216,0.2);
  padding: 10px 20px;
  margin-top: 8px;
  transition: border-color 0.15s, color 0.15s;
  width: fit-content;
}
.drop-external-btn:hover { border-color: var(--red); color: var(--red); }

/* CORPO DO TEXTO */
.drop-body {
  font-family: var(--f-body);
  font-size: 20px;
  line-height: 1.8;
  color: rgba(232,232,216,0.78);
}

.drop-body p { margin-bottom: 24px; }
.drop-body p:last-child { margin-bottom: 0; }
.drop-body strong { color: var(--fg); font-weight: 600; }
.drop-body a { color: var(--red); text-decoration: none; border-bottom: 1px solid rgba(232,50,10,0.3); }
.drop-body a:hover { border-color: var(--red); }
.drop-body h2, .drop-body h3 {
  font-family: var(--f-title);
  letter-spacing: 0.04em;
  margin: 36px 0 16px;
  color: var(--fg);
}
.drop-body h2 { font-size: 28px; }
.drop-body h3 { font-size: 22px; }

/* SIDEBAR — outros drops */
.drop-sidebar {
  position: sticky;
  top: 88px;
}

.sidebar-label {
  font-family: var(--f-ui);
  font-size: 8.5px;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: rgba(232,50,10,0.5);
  margin-bottom: 14px;
}

/* filtros na sidebar */
.sidebar-filter-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 16px;
}

.sidebar-filter-btn {
  font-family: var(--f-ui);
  font-size: 8px;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  padding: 4px 10px;
  border: 1px solid rgba(232,50,10,0.2);
  color: rgba(232,232,216,0.3);
  background: none;
  cursor: crosshair;
  transition: all 0.15s;
}
.sidebar-filter-btn:hover { border-color: var(--red); color: var(--red); }
.sidebar-filter-btn[data-type="all"].active    { border-color: var(--fg);     color: var(--fg); }
.sidebar-filter-btn[data-type="book"].active   { border-color: var(--yellow); color: var(--yellow); }
.sidebar-filter-btn[data-type="album"].active  { border-color: var(--green);  color: var(--green); }
.sidebar-filter-btn[data-type="podcast"].active{ border-color: var(--purple); color: var(--purple); }
.sidebar-filter-btn[data-type="film"].active   { border-color: var(--blue);   color: var(--blue); }

/* lista de drops na sidebar */
.sidebar-drop-list {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.sidebar-drop-item {
  display: grid;
  grid-template-columns: 52px 1fr;
  gap: 12px;
  padding: 10px;
  text-decoration: none;
  color: var(--fg);
  background: #111109;
  border: 1px solid rgba(255,255,255,0.04);
  cursor: crosshair;
  transition: border-color 0.15s;
  align-items: center;
}
.sidebar-drop-item:hover { border-color: var(--red); }
.sidebar-drop-item.current { border-color: rgba(204,68,255,0.4); }

.sidebar-drop-thumb {
  width: 52px;
  height: 52px;
  object-fit: cover;
  display: block;
  filter: contrast(1.1) saturate(0.5);
}

.sidebar-drop-thumb-placeholder {
  width: 52px;
  height: 52px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--f-ui);
  font-size: 7px;
  letter-spacing: 0.1em;
  color: rgba(255,255,255,0.1);
}
.sidebar-drop-thumb-placeholder.type-book    { background: #1a1208; }
.sidebar-drop-thumb-placeholder.type-album   { background: #08121a; }
.sidebar-drop-thumb-placeholder.type-podcast { background: #120a1a; }
.sidebar-drop-thumb-placeholder.type-film    { background: #0a1a0a; }

.sidebar-drop-info {}
.sidebar-drop-title {
  font-family: var(--f-ui);
  font-size: 11px;
  line-height: 1.2;
  margin-bottom: 3px;
}
.sidebar-drop-author {
  font-family: var(--f-ui);
  font-size: 8px;
  letter-spacing: 0.08em;
  color: rgba(232,232,216,0.3);
  text-transform: uppercase;
}

/* FOOTER */
footer {
  border-top: 1px solid rgba(232,50,10,0.18);
  padding: 18px 24px;
  display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px;
}
footer span { font-family: var(--f-ui); font-size: 8.5px; letter-spacing: 0.13em; text-transform: uppercase; color: rgba(232,232,216,0.14); }

/* RESPONSIVE */
@media (max-width: 900px) {
  .drop-wrap { grid-template-columns: 1fr; }
  .drop-sidebar { position: static; margin-top: 48px; border-top: 1px solid rgba(232,50,10,0.15); padding-top: 40px; }
}
@media (max-width: 520px) {
  .drop-header { grid-template-columns: 1fr; }
  .drop-cover-large { width: 100%; }
  .drop-cover-img, .drop-cover-placeholder { width: 100%; }
}
</style>
</head>
<body>

<nav>
  <div class="nav-logo">
    <a href="index.html" class="nav-logo-title">WEIRD WIZ</a>
    <span class="nav-logo-sub">a blog about art creativity<br>tech books and consciousness</span>
  </div>
  <ul class="nav-links">
    <li><span class="nav-sep">..·</span><a href="works.html">I worked on</a></li>
    <li><span class="nav-sep">:·</span><a href="posts.html">Posts</a></li>
    <li><span class="nav-sep">.·.</span><a href="drops.html" class="active">Drops</a></li>
    <li><span class="nav-sep">-·</span><a href="index.html#me">Me</a></li>
  </ul>
</nav>

<div class="drop-wrap">

  <!-- COLUNA PRINCIPAL -->
  <main class="drop-main" id="drop-main">
    <a href="drops.html" class="back-btn">← drops</a>
    <div id="drop-content">
      <div style="font-family:var(--f-ui);font-size:10px;letter-spacing:0.1em;color:rgba(232,232,216,0.3);padding-top:40px;">carregando...</div>
    </div>
  </main>

  <!-- SIDEBAR — outros drops -->
  <aside class="drop-sidebar" id="drop-sidebar">
    <div class="sidebar-label">— outros drops</div>
    <div class="sidebar-filter-bar" id="sidebar-filter-bar"></div>
    <div class="sidebar-drop-list" id="sidebar-drop-list"></div>
  </aside>

</div>

<footer>
  <span>© 2025 Weird Wiz</span>
  <div class="footer-nl">
    <form id="nl-form-footer-drop"
          action="https://00bc7bfa.sibforms.com/serve/MUIFAP6Irrw--9y9roSCjipmIl4QR0T4wNHGL7l3E3UeY6kVH3b2sscz8ok4KT7n3UBxLtxBmrvtMMkSbyE9mfORmip7vX7y2z6PllCs5twrQmEg47eiJdgNP_mK__9s2-LLLtTCJA2qQO3fbMzyym_sdAkHL_0dMmGuC4JbQ0bTmFz11oDurorHHcJzHrxnEZEnT3V58kfQA_pSqQ=="
          method="POST"
          target="nl-iframe-footer-drop">
      <input type="email" name="EMAIL" class="footer-nl-input"
             placeholder="receba novos posts por email" required autocomplete="email">
      <input type="hidden" name="email_address_check" value="">
      <input type="hidden" name="locale" value="pt">
      <button type="submit" class="footer-nl-btn">→</button>
    </form>
    <iframe name="nl-iframe-footer-drop" style="display:none;" title="newsletter"></iframe>
    <span class="footer-nl-ok" id="nl-ok-footer-drop">✓ inscrito</span>
  </div>
  <span>made by hand</span>
</footer>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>

async function getDropFiles() {
  try {
    const res = await fetch('https://api.github.com/repos/dlameira/dlameira.github.io/contents/content/drops');
    if (!res.ok) throw new Error('API error');
    const files = await res.json();
    return files
      .filter(f => f.type === 'file' && f.name.endsWith('.md'))
      .map(f => `content/drops/${f.name}`);
  } catch(e) {
    return [
      'content/drops/antifragile.md','content/drops/ok-computer.md',
      'content/drops/lex-fridman-367.md','content/drops/steve-jobs.md',
      'content/drops/arrival.md','content/drops/master-and-margarita.md',
      'content/drops/godel-escher-bach.md','content/drops/the-wave-watcher-companion.md',
      'content/drops/kid-a.md','content/drops/a-hora-da-estrela.md',
      'content/drops/fargo-s01.md','content/drops/in-rainbows.md',
      'content/drops/o-castelo.md','content/drops/hardcore-history.md',
      'content/drops/2001-odisseia.md','content/drops/a-sociedade-do-cansaco.md',
      'content/drops/99-percent-invisible.md',
    ];
  }
}

const TYPE_LABELS = { all: 'Todos', book: 'Livros', album: 'Álbuns', podcast: 'Podcasts', film: 'Filmes' };

function parseFrontmatter(text) {
  const match = text.match(/^---\n([\s\S]*?)\n---/);
  if (!match) return { meta: {}, body: text };
  const meta = {};
  match[1].split('\n').forEach(line => {
    const [key, ...val] = line.split(':');
    if (key && val.length) meta[key.trim()] = val.join(':').trim().replace(/^"|"$/g, '');
  });
  return { meta, body: text.slice(match[0].length).trim() };
}

async function fetchMarkdownList(files) {
  const results = [];
  for (const file of files) {
    try {
      const res = await fetch(file);
      if (!res.ok) continue;
      const text = await res.text();
      const { meta, body } = parseFrontmatter(text);
      results.push({ ...meta, body, _file: file });
    } catch(e) {}
  }
  return results;
}

function fileToSlug(filepath) {
  return filepath.split('/').pop().replace('.md', '');
}

function coverHtml(drop, size = 'thumb') {
  const cls = size === 'thumb' ? 'sidebar-drop-thumb' : 'drop-cover-img';
  const phCls = size === 'thumb' ? 'sidebar-drop-thumb-placeholder' : 'drop-cover-placeholder';
  if (drop.cover) {
    return `<img src="${drop.cover}" alt="${drop.title}" class="${cls}">`;
  }
  return `<div class="${phCls} type-${drop.type || 'book'}">${drop.type || ''}</div>`;
}

// ── SIDEBAR ────────────────────────────────────────────────────────────────
let allDrops = [];
let currentSlug = '';
let activeType = 'all';

function renderSidebarFilters(drops) {
  const bar = document.getElementById('sidebar-filter-bar');
  const types = ['all', ...new Set(drops.map(d => d.type).filter(Boolean))];
  bar.innerHTML = '';
  types.forEach(type => {
    const btn = document.createElement('button');
    btn.className = `sidebar-filter-btn${type === activeType ? ' active' : ''}`;
    btn.dataset.type = type;
    btn.textContent = TYPE_LABELS[type] || type;
    btn.addEventListener('click', () => {
      activeType = type;
      document.querySelectorAll('.sidebar-filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      renderSidebarList(allDrops);
    });
    bar.appendChild(btn);
  });
}

function renderSidebarList(drops) {
  const list = document.getElementById('sidebar-drop-list');
  const filtered = activeType === 'all'
    ? drops.filter(d => fileToSlug(d._file) !== currentSlug)
    : drops.filter(d => d.type === activeType && fileToSlug(d._file) !== currentSlug);

  list.innerHTML = '';
  if (filtered.length === 0) {
    list.innerHTML = '<div style="font-family:var(--f-ui);font-size:9px;letter-spacing:0.12em;color:rgba(232,232,216,0.18);padding:16px 0;">nenhum drop</div>';
    return;
  }

  filtered.sort((a,b) => (a.order||99) - (b.order||99)).forEach(drop => {
    const slug = fileToSlug(drop._file);
    const a = document.createElement('a');
    a.href = `drop.html?slug=${slug}`;
    a.className = 'sidebar-drop-item';
    a.innerHTML = `
      ${coverHtml(drop, 'thumb')}
      <div class="sidebar-drop-info">
        <div class="sidebar-drop-title">${drop.title || ''}</div>
        <div class="sidebar-drop-author">${drop.author || ''}</div>
      </div>`;
    list.appendChild(a);
  });
}

// ── MAIN DROP ─────────────────────────────────────────────────────────────
async function loadDrop() {
  const params = new URLSearchParams(window.location.search);
  currentSlug = params.get('slug') || '';

  const file = DROP_FILES.find(f => f.includes(currentSlug));
  if (!file) {
    document.getElementById('drop-content').innerHTML =
      '<p style="color:rgba(232,232,216,0.4);font-family:var(--f-ui);font-size:11px;">Drop não encontrado.</p>';
    return;
  }

  const res = await fetch(file);
  const text = await res.text();
  const { meta, body } = parseFrontmatter(text);

  document.title = `WEIRD WIZ – ${meta.title || 'Drop'}`;

  const typeClass = `type-${meta.type || 'book'}`;

  const externalBtn = meta.link
    ? `<a href="${meta.link}" target="_blank" rel="noopener" class="drop-external-btn">Acessar ↗</a>`
    : '';

  const bodyHtml = body
    ? `<div class="drop-body">${marked.parse(body)}</div>`
    : '';

  const coverEl = meta.cover
    ? `<img src="${meta.cover}" alt="${meta.title}" class="drop-cover-img">`
    : `<div class="drop-cover-placeholder ${typeClass}">${meta.type || ''}</div>`;

  document.getElementById('drop-content').innerHTML = `
    <div class="drop-header">
      <div class="drop-cover-large">${coverEl}</div>
      <div class="drop-header-info">
        <span class="drop-type-badge ${typeClass}">${meta.type || ''}</span>
        <h1 class="drop-detail-title">${(meta.title || '').toUpperCase()}</h1>
        <div class="drop-detail-author">${meta.author || ''}</div>
        ${meta.note ? `<p class="drop-detail-note">${meta.note}</p>` : ''}
        ${externalBtn}
      </div>
    </div>
    ${bodyHtml}
  `;

  // sidebar: default filter = mesmo tipo do drop atual
  activeType = meta.type || 'all';
  renderSidebarFilters(allDrops);
  renderSidebarList(allDrops);
}

async function init() {
  const DROP_FILES = await getDropFiles();
  allDrops = await fetchMarkdownList(DROP_FILES);
  await loadDrop();
}

init();
document.getElementById('nl-form-footer-drop')?.addEventListener('submit', function() {
  setTimeout(() => { this.style.display='none'; document.getElementById('nl-ok-footer-drop').style.display='inline'; }, 600);
});
</script>

</body>
</html>
